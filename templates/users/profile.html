{% extends 'base.html' %}
{% load static %}

{% block title %}
  –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
{% endblock %}

{% block extra_css %}
  <style>
    .profile {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .profile img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #e10600;
    }
    .profile-info {
      flex-grow: 1;
    }
    .progress-bar {
      background: #1a1a1a;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 8px;
    }
    .progress-bar-inner {
      background: #e10600;
      height: 100%;
      width: 60%;
    }
    section {
      margin-bottom: 3rem;
    }
    button {
      background: #e10600;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 0.7rem;
    }
    button:hover {
      background: #b10500;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      background: #1a1a1a;
      margin-bottom: 0.7rem;
      padding: 0.8rem;
      border-radius: 6px;
    }
    label {
      display: block;
      margin-top: 0.5rem;
    }
    input[type='text'],
    input[type='email'],
    input[type='file'] {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: none;
      background: #1c1c1c;
      color: white;
      margin-top: 0.3rem;
      box-sizing: border-box;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="container">
    {% include 'components/nav.html' %}
    <h1>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <section id="profile-section">
      <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <div class="profile">
        <img src="{% if user.photo %}
            {{ user.photo.url }}
          {% else %}
            {% static 'default-avatar.png' %}
          {% endif %}"
          alt="–§–æ—Ç–æ —É—á–µ–Ω–∏–∫–∞"
          id="profile-photo" />
        <div class="profile-info">
          <p>
            <strong>–ò–º—è:</strong> {{ user.get_full_name|default:user.username }}
          </p>
          <p>
            <strong>–ê–∫–∞–¥–µ–º–∏—è:</strong> –ù–µ —É–∫–∞–∑–∞–Ω–æ
          </p>
          <p>
            <strong>–¢—Ä–µ–Ω–µ—Ä:</strong> –ù–µ —É–∫–∞–∑–∞–Ω–æ
          </p>
          <div>
            <strong>–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:</strong>
            <div class="progress-bar">
              <div class="progress-bar-inner" id="progress-bar-inner" style="width:60%"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
    <section id="achievements-section">
      <h2>–ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h2>
      <ul id="achievements-list">
        {% if achievements %}
          {% for achievement in achievements %}
            <li>{{ achievement }}</li>
          {% endfor %}
        {% else %}
          <li>üèÖ –ú–µ–¥–∞–ª—å –∑–∞ 1 –º–µ—Å—Ç–æ –Ω–∞ —Ç—É—Ä–Ω–∏—Ä–µ Almaty Open 2025</li>
          <li>üéñ –£—á–∞—Å—Ç–Ω–∏–∫ —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞ Karaganda 2025</li>
          <li>üéó –ê–∫—Ç–∏–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</li>
        {% endif %}
      </ul>
    </section>
    <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
    <section id="orders-section">
      <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
      <ul id="order-history"></ul>
    </section>
    <!-- –ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç—ã -->
    <section id="stripe-card">
      <h2>–û–ø–ª–∞—Ç–∞ –∏ –∫–∞—Ä—Ç–∞</h2>
      <p>–î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫–∞—Ä—Ç—ã –∏ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Stripe –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É:</p>
      <button onclick="linkCard()">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–∞—Ä—Ç—É</button>
    </section>
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è -->
    <section id="settings-section">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
      <a href="{% url 'users:profile_update' %}" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
    </section>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    const orders = [
      { id: 1, product: '–ö—É—Ä—Ç–∫–∞', method: 'Stripe', status: '–í—ã–ø–æ–ª–Ω–µ–Ω' },
      { id: 2, product: '–§—É—Ç–±–æ–ª–∫–∞', method: '–ë–∞–ª–ª—ã', status: '–í—ã–ø–æ–ª–Ω–µ–Ω' }
    ]
    function renderOrderHistory() {
      const ul = document.getElementById('order-history')
      ul.innerHTML = ''
      if (orders.length === 0) {
        ul.innerHTML = '<li>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</li>'
        return
      }
      orders.forEach((order) => {
        const li = document.createElement('li')
        li.innerHTML = `<strong>–¢–æ–≤–∞—Ä:</strong> ${order.product}<br>
                <strong>–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã:</strong> ${order.method}<br>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> ${order.status}`
        ul.appendChild(li)
      })
    }
    function linkCard() {
      alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫–∞—Ä—Ç—ã —Ç—Ä–µ–±—É–µ—Ç backend-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Stripe.')
    }
    document.addEventListener('DOMContentLoaded', function () {
      renderOrderHistory()
    })
  </script>
{% endblock %}
